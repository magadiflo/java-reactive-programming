# Sección 4: Flux - Emitiendo items programáticamente

---

## Flux.create() – Emisión imperativa de elementos

En la sección anterior, habíamos hablado de algunas opciones para crear un flujo, por ejemplo a partir de una lista, un
arreglo, etc. Eso es bueno cuando ya tenemos esos tipos en algún lugar del código y podemos crear un flujo a partir de
ahí. Pero probablemente nos falte algo, es decir, nosotros como desarrolladores, necesitamos la capacidad de emitir
un elemento mediante programación, seguir emitiendo datos hasta que se cumpla alguna condición. Para ese escenario
`Reactor` ofrece un par de opciones, eso es lo que veremos en este apartado.

A continuación demostramos cómo crear un `Flux` que emite elementos manualmente mediante programación,
en lugar de usar datos ya existentes.

````java
public class Lec01FluxCreate {
    public static void main(String[] args) {
        Flux.create(fluxSink -> {
            String country;
            do {
                country = Util.faker().country().name();    // genera un país aleatorio
                fluxSink.next(country);                     // emite el país al Flux
            } while (!country.equalsIgnoreCase("Peru"));    // sigue hasta que se emita "Peru"

            fluxSink.complete();                            // indica que el flujo ha terminado
        }).subscribe(Util.subscriber());
    }
}
````

### Donde

- `Flux.create(...)`, crea un `Flux` manualmente usando un `FluxSink`. Nosotros decidimos cuándo y qué emitir.
- `FluxSink<T>`, es una interfaz que actúa como puente entre tu código imperativo y el mundo reactivo. Es el objeto que
  recibimos en el lambda de `Flux.create()`, y nos permite emitir elementos manualmente a un `Flux`.
- `FluxSink` nos da el control manual de cuándo y cómo se emiten los elementos en un `Flux`.
- `fluxSink.next(...)`, emite un nuevo valor al flujo.
- `fluxSink.complete()`, finaliza la emisión (completa el flujo).

El ejemplo muestra cómo `Flux.create()` da control completo sobre el proceso de emisión. Además, es ideal para demostrar
cómo simular condiciones de parada en flujos programáticos.

````bash
18:05:44.769 INFO  [           main] d.m.a.common.DefaultSubscriber :  recibido: Guinea-Bissau
18:05:44.769 INFO  [           main] d.m.a.common.DefaultSubscriber :  recibido: Venezuela (Bolivarian Republic of)
18:05:44.769 INFO  [           main] d.m.a.common.DefaultSubscriber :  recibido: Guinea-Bissau
18:05:44.769 INFO  [           main] d.m.a.common.DefaultSubscriber :  recibido: Samoa
18:05:44.769 INFO  [           main] d.m.a.common.DefaultSubscriber :  recibido: Egypt
18:05:44.769 INFO  [           main] d.m.a.common.DefaultSubscriber :  recibido: Egypt
18:05:44.770 INFO  [           main] d.m.a.common.DefaultSubscriber :  recibido: Greece
18:05:44.770 INFO  [           main] d.m.a.common.DefaultSubscriber :  recibido: Tajikistan
18:05:44.770 INFO  [           main] d.m.a.common.DefaultSubscriber :  recibido: Peru
18:05:44.774 INFO  [           main] d.m.a.common.DefaultSubscriber :  ¡completado!
````
